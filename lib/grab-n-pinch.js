var l=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var x=Object.prototype.hasOwnProperty;var f=i=>l(i,"__esModule",{value:!0});var y=(i,t)=>{for(var e in t)l(i,e,{get:t[e],enumerable:!0})},d=(i,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of u(t))!x.call(i,a)&&(e||a!=="default")&&l(i,a,{get:()=>t[a],enumerable:!(s=p(t,a))||s.enumerable});return i};var g=(i=>(t,e)=>i&&i.get(t)||(e=d(f({}),t,1),i&&i.set(t,e),e))(typeof WeakMap!="undefined"?new WeakMap:0);var V={};y(V,{GrabNPinchManager:()=>m,mapEventToPointer:()=>c,updatePointerByEvent:()=>b});var n={add:(i,t)=>({x:i.x+t.x,y:i.y+t.y}),subt:(i,t)=>({x:i.x-t.x,y:i.y-t.y}),neg:i=>({x:-i.x,y:-i.y}),mult:(i,t)=>({x:i.x*t,y:i.y*t}),hypot:i=>(i.x**2+i.y**2)**.5,eq:(i,t)=>i===t?!0:!i||!t?!1:i.x===t.x&&i.y===t.y,from:({x:i,y:t})=>({x:i,y:t}),fromSize:i=>({x:i.width,y:i.height}),assignSize:(i,t)=>Object.assign(i,{width:t.x,height:t.y}),fromClientSize:i=>({x:i.clientWidth,y:i.clientHeight}),proceed:(i,t)=>{let e=n.from(i);return s=>n.assign(i,{x:e.x*(1-s)+t.x*s,y:e.y*(1-s)+t.y*s})},d:(i,t)=>n.hypot(n.subt(t,i)),assign:(i,t)=>(i.x=typeof t=="number"?t:t.x,i.y=typeof t=="number"?t:t.y,i),origin:{x:0,y:0},map:(i,t)=>({x:t(i.x),y:t(i.y)}),in:(i,t,e)=>t.x>=i.x&&t.x<e.x&&t.y>=i.y&&t.y<e.y,map2d:(i,t)=>i.map((e,s)=>e.map((a,r)=>t(a,{x:s,y:r}))),fill2d:(i,t)=>i.map(e=>e.map(()=>t)),get2d:(i,t)=>i[t.x][t.y],set2d:(i,t,e)=>{i[t.x][t.y]=e},in2d:(i,t)=>t.x>=0&&t.x<i.length&&t.y>=0&&t.y<i[i.length-1].length,from2dSize:i=>({x:i.length,y:i[0].length})};function c(i){if(!(i instanceof PointerEvent))throw new Error("Cannot handle event which is not pointer event");let t={x:i.x,y:i.y,timeStamp:i.timeStamp};return{...t,pointerId:i.pointerId,initial:t}}function b(i,t){return Object.assign(i,{x:t.x,y:t.y,timeStamp:t.timeStamp})}var m=class{translate={x:0,y:0};scale=1;pointers=[];maybeClick=!1;clicked=null;pointingContext=null;minScale=0;maxScale=1/0;constructor({translate:t,scale:e,minScale:s,maxScale:a}={}){e&&(this.scale=e),t&&(this.translate=t),s&&(this.minScale=s),a&&(this.maxScale=a)}viewportPoint=t=>n.mult(t,this.scale);drawingPoint=t=>n.map(n.mult(n.subt(t,this.translate),1/this.scale),Math.floor);addPointer=t=>{let e=c(t);this.pointers.push(e),!(this.pointers.length===0||this.pointers.length>2)&&(this.pointingContext={point0:n.from(e),translate0:n.from(this.translate),scale0:this.scale,pinch0:this.pointers.length===2?n.d(this.pointers[0],this.pointers[1]):0,vRefPointer:{...e},velocity:{x:0,y:0}},this.inertia=null,this.maybeClick=!0)};updatePointer=t=>{let e;for(let s=0;s<this.pointers.length;s+=1)if(this.pointers[s].pointerId===t.pointerId){e=Object.assign(this.pointers[s],{x:t.x,y:t.y,timeStamp:t.timeStamp});break}if(!(!e||!this.pointingContext||this.pointers.length===0||this.pointers.length>2))if(this.pointers.length===2){t.preventDefault(),this.maybeClick=!1;let{point0:s,translate0:a,scale0:r,pinch0:o}=this.pointingContext,h=n.d(this.pointers[0],this.pointers[1]);this.scale=Math.min(Math.max(this.minScale,r*(h/o)),this.maxScale),this.translate=n.add(s,n.mult(n.subt(a,s),h/o)),this.pointingContext.velocity={x:0,y:0}}else{let{vRefPointer:s}=this.pointingContext,a=e.timeStamp-s.timeStamp;a>16.6667&&(t.preventDefault(),this.maybeClick=!1,this.pointingContext.velocity=n.mult(n.subt(e,s),1/a),this.pointingContext.vRefPointer={...e}),n.assign(this.translate,n.add(this.pointingContext.translate0,n.subt(e,e.initial)))}};inertia=null;removePointer=t=>{let e=null;for(let s=0;s<this.pointers.length;s+=1)if(this.pointers[s].pointerId===t.pointerId){[e]=this.pointers.splice(s,1);break}if(this.pointers.length===2)t.preventDefault(),this.maybeClick=!1,this.pointingContext={point0:this.pointers[1],translate0:n.from(this.translate),scale0:this.scale,pinch0:n.d(this.pointers[0],this.pointers[1]),vRefPointer:{...this.pointers[1]},velocity:{x:0,y:0}};else if(this.pointers.length===1)t.preventDefault(),this.maybeClick=!1,this.pointers[0]={...this.pointers[0],timeStamp:t.timeStamp,initial:{...n.from(this.pointers[0]),timeStamp:t.timeStamp}},this.pointingContext={point0:n.from(this.pointers[0]),translate0:n.from(this.translate),scale0:this.scale,pinch0:0,vRefPointer:{...this.pointers[0]},velocity:{x:0,y:0}};else if(this.pointingContext){if(!this.maybeClick&&e){t.preventDefault();let{vRefPointer:s}=this.pointingContext,a=t.timeStamp-s.timeStamp;a>16.6667&&(this.pointingContext.velocity=n.mult(n.subt(t,s),1/a));let r=this.pointingContext?n.hypot(this.pointingContext.velocity):null;this.inertia=r!==null&&r>=.5?{p:0,v0:this.pointingContext.velocity,vqty:r}:null}this.maybeClick?this.pointingContext=null:this.clicked=null}};scaleInertia=null;updateScaleInertia=t=>{this.pointingContext&&n.assign(this.pointingContext.point0,t),this.scaleInertia||(this.scaleInertia={v:0,point0:n.from(t),translate0:n.from(this.translate),scale0:this.scale}),this.inertia&&(this.inertia=null),this.scaleInertia.v-=Math.sign(t.deltaY)*.5};run=t=>{if(this.inertia&&this.inertia.p<1){let e=n.mult(this.inertia.v0,1-this.inertia.p);n.assign(this.translate,n.add(this.translate,n.mult(e,t))),this.inertia.p+=t/(this.inertia.vqty*512),this.inertia.p>=1&&(this.inertia=null)}if(this.scaleInertia?.v){let{point0:e,translate0:s,scale0:a}=this.scaleInertia,r=this.scale*(1+this.scaleInertia.v*(t/128));this.scale=Math.min(Math.max(this.minScale,r),this.maxScale),this.translate=n.add(e,n.mult(n.subt(s,e),this.scale/a)),this.pointingContext&&Object.assign(this.pointingContext,{translate0:n.from(this.translate),scale0:this.scale});let o=this.scaleInertia.v-Math.sign(this.scaleInertia.v)*(t/128);this.scaleInertia.v=Math.max(-4,Math.min(o,4)),Math.abs(this.scaleInertia.v)<.1&&(this.scaleInertia=null)}}};module.exports=g(V);
//# sourceMappingURL=grab-n-pinch.js.map
